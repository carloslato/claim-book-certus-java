<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout.html}">

<div layout:fragment="content">
  
	<h3 th:text="'Reclamo: ' + ${reclamo.codigoSeguimiento}"></h3>
	
	<p><b>Nombre:</b> <span th:text="${reclamo.nombre}"></span></p>
	<p><b>Descripci√≥n:</b> <span th:text="${reclamo.descripcion}"></span></p>
	
	<hr>
	
	<h4>Respuestas</h4>
	
	<ul class="uk-list uk-list-striped">
	    <li th:each="r : ${reclamo.respuestas}">
	        <b th:text="${r.autor}"></b>:
	        <span th:text="${r.mensaje}"></span>
	        <div class="uk-text-meta" th:text="${#temporals.format(r.createdAt,'dd/MM/yyyy HH:mm')}"></div>
	    </li>
	</ul>
	
	<hr>
	
	<h4>Responder</h4>
	
	<form id="form-respuesta">
	    <textarea class="uk-textarea" name="mensaje" required></textarea>
	    <input type="hidden" name="autor" value="USUARIO">
	    <button class="uk-button uk-button-primary uk-margin-small-top">Enviar respuesta</button>
	</form>

</div>

<script layout:fragment="script">
const idReclamo = [[${reclamo.id}]];

document.querySelector("#form-respuesta").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target));

    await fetch(`/api/reclamos/responder/${idReclamo}`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify(data)
    });

    location.reload();
});
</script>

</html>
